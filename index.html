<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Watch and Manage Claude Code in 3D!" />
    <meta name="theme-color" content="#0f172a" />
    <title>Vibecraft - Watch and Manage Claude Code in 3D!</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/logo.svg" />

    <!-- Open Graph / Social -->
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Vibecraft" />
    <meta property="og:title" content="Vibecraft - Watch and Manage Claude Code in 3D!" />
    <meta property="og:description" content="Watch and Manage Claude Code in 3D!" />
    <meta property="og:image" content="https://vibecraft.sh/og-image.png" />
    <meta property="og:url" content="https://vibecraft.sh" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Vibecraft - Watch and Manage Claude Code in 3D!" />
    <meta name="twitter:description" content="Watch and Manage Claude Code in 3D!" />
    <meta name="twitter:image" content="https://vibecraft.sh/og-image.png" />

    <!-- Analytics -->
    <script src="https://cdn.amplitude.com/script/3b78e993d3c7ddad9fb9ae615cc094b6.js"></script>
    <script>window.amplitude.init('3b78e993d3c7ddad9fb9ae615cc094b6', {"fetchRemoteConfig":true,"autocapture":{"attribution":true,"fileDownloads":true,"formInteractions":true,"pageViews":true,"sessions":true,"elementInteractions":true,"networkTracking":true,"webVitals":true,"frustrationInteractions":true}});</script>
  </head>
  <body>
    <div id="app">
      <!-- Left: 3D Scene -->
      <div id="scene-panel">
        <div id="canvas-container"></div>

        <!-- Scene HUD -->
        <div id="scene-hud">
          <div class="scene-badge unified-hud">
            <div id="status-dot"></div>
            <span id="username" class="hud-user">...</span>
            <span id="status-text"></span>
            <span class="hud-sep">|</span>
            <span id="token-counter" class="hud-tokens" data-i18n-title="hud.tokens_used" title="Tokens used this session">‚ö° 0 tok</span>
            <span class="hud-sep">|</span>
            <button id="settings-btn" class="hud-btn" data-i18n-title="hud.settings" title="Settings">‚öôÔ∏è</button>
            <!-- Debug: FPS counter (uncomment to enable)
            <span class="hud-sep">|</span>
            <span id="fps" class="hud-fps">-- FPS</span>
            -->
          </div>
        </div>

        <!-- Dev Panel (animations test) - hidden by default -->
        <div id="dev-panel" class="hidden">
          <div class="dev-header">üé¨ Animations</div>
          <div id="dev-animations"></div>
        </div>

        <!-- Keybind Helper (bottom-left) -->
        <div id="keybind-helper">
          <div class="keybind-list">
            <span class="keybind"><kbd>1-6</kbd> sessions ¬∑ <kbd>`</kbd><kbd>0</kbd> all ¬∑ <kbd>Tab</kbd> focus ¬∑ <kbd>D</kbd> draw</span>
          </div>
        </div>

        <!-- Voice Control (center bottom) -->
        <div id="voice-control" class="voice-control">
          <!-- Idle state: mic button with hint -->
          <div class="voice-idle">
            <button type="button" id="voice-btn" class="voice-trigger" data-i18n-title="voice.start" title="Start voice input">üé§</button>
            <span class="voice-hint"><kbd>Ctrl</kbd><kbd>M</kbd></span>
          </div>
          <!-- Recording state: bars + dot -->
          <div class="voice-recording">
            <div class="voice-bars">
              <div class="voice-bar" data-bar="0"></div>
              <div class="voice-bar" data-bar="1"></div>
              <div class="voice-bar" data-bar="2"></div>
              <div class="voice-bar" data-bar="3"></div>
              <div class="voice-bar" data-bar="4"></div>
              <div class="voice-bar" data-bar="5"></div>
              <div class="voice-bar" data-bar="6"></div>
              <div class="voice-bar" data-bar="7"></div>
              <div class="voice-bar" data-bar="8"></div>
              <div class="voice-bar" data-bar="9"></div>
            </div>
            <div class="voice-status-row">
              <div class="voice-record-dot"></div>
              <span class="voice-send-hint" data-i18n="voice.send_hint">Enter to send</span>
            </div>
          </div>
        </div>

        <!-- Draw Mode UI (bottom right of scene) -->
        <div id="draw-indicator">
          <span class="draw-mode-label" data-i18n="hud.draw_mode">DRAW MODE</span>
          <span class="draw-mode-hint"><kbd>D</kbd> <span data-i18n="hud.draw_exit">exit</span> ¬∑ <kbd>X</kbd> <span data-i18n="hud.draw_clear">clear</span> ¬∑ <kbd>Q</kbd><kbd>E</kbd> <span data-i18n="hud.draw_brush">brush</span> ¬∑ <kbd>R</kbd> <span data-i18n="hud.draw_3d">3D</span></span>
        </div>
        <div id="draw-palette">
          <!-- Populated by DrawMode.ts -->
        </div>

      </div>

      <!-- Right: Activity Feed -->
      <div id="feed-panel">
        <div id="feed-header">
          <h2>Vibecraft <span class="muted">(vibecraft.sh)</span></h2>
          <div class="feed-header-right">
            <span id="attention-badge" class="attention-badge hidden">0</span>
            <button id="about-btn" class="feed-about-btn" title="About Vibecraft">?</button>
          </div>
        </div>

        <!-- Session Management -->
        <div id="sessions-panel">
          <div id="sessions-list">
            <div class="session-item all-sessions active" data-session="all">
              <div class="session-hotkey">0</div>
              <div class="session-icon">üìã</div>
              <div class="session-info">
                <div class="session-name" data-i18n="sessions.all_sessions">All Sessions</div>
                <div class="session-detail" id="all-sessions-count" data-i18n="sessions.no_active">No active sessions</div>
              </div>
            </div>
            <div id="managed-sessions"></div>
          </div>
        </div>

        <!-- Terminal output panel (hidden by default) -->
        <div id="terminal-panel" class="hidden">
          <div id="terminal-output"></div>
        </div>

        <div id="activity-feed-wrapper">
          <div id="activity-feed">
            <div id="feed-empty">
              <div id="feed-empty-icon">üõ†Ô∏è</div>
              <h3 data-i18n="sessions.waiting">Waiting for activity</h3>
              <p data-i18n="sessions.waiting_hint">Start using Claude Code to see events here</p>
            </div>
          </div>
          <button id="feed-scroll-bottom" data-i18n="sessions.jump_latest">‚Üì Jump to latest</button>
        </div>

        <div id="prompt-container">
          <div id="voice-transcript">
            <div class="transcript-label"><span class="recording-dot"></span> <span data-i18n="voice.listening">Listening...</span></div>
            <div id="voice-transcript-text"></div>
          </div>
          <form id="prompt-form">
            <div class="input-wrapper">
              <textarea id="prompt-input" data-i18n="prompt_placeholder" placeholder="Prompt..." data-i18n-placeholder="modals.new_zone.other_placeholder" autocomplete="off" rows="1"></textarea>
            </div>
            <button type="submit" id="prompt-submit"><span class="btn-icon">‚Üó</span> <span data-i18n="common.send">Send</span></button>
            <button type="button" id="prompt-cancel"><span class="btn-icon">‚óº</span> <span data-i18n="common.stop">Stop</span></button>
          </form>
          <div id="prompt-options">
            <span id="prompt-target"></span>
            <span id="prompt-status"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- New Session Modal -->
    <div id="new-session-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="modals.new_zone.title">New Zone</h3>
        </div>

        <div class="modal-field">
          <label for="session-cwd-input" data-i18n="modals.new_zone.directory">Directory</label>
          <input type="text" id="session-cwd-input" data-i18n="modals.new_zone.directory_placeholder" placeholder="e.g. /home/user/my-project" autocomplete="off" />
          <div class="field-hint"><span data-i18n="modals.new_zone.default">Default</span>: <code id="modal-default-cwd">~</code></div>
        </div>

        <div class="modal-field">
          <label for="session-name-input" data-i18n="modals.new_zone.name">Name</label>
          <input type="text" id="session-name-input" data-i18n="modals.new_zone.name_placeholder" placeholder="Auto-filled from directory..." autocomplete="off" />
        </div>

        <div class="modal-field">
          <label data-i18n="modals.new_zone.options">Options</label>
          <div class="modal-checkboxes">
            <label class="modal-checkbox">
              <input type="checkbox" id="session-opt-continue" />
              <span class="checkbox-label"><span data-i18n="modals.new_zone.continue">Continue</span> <code>-c</code></span>
            </label>
            <label class="modal-checkbox">
              <input type="checkbox" id="session-opt-skip-perms" checked />
              <span class="checkbox-label" data-i18n="modals.new_zone.skip_perms">Skip permissions <code>--dangerously-skip-permissions</code></span>
            </label>
            <label class="modal-checkbox">
              <input type="checkbox" id="session-opt-chrome" />
              <span class="checkbox-label" data-i18n="modals.new_zone.chrome">Chrome <code>--chrome</code></span>
            </label>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="modal-btn modal-btn-cancel" id="modal-cancel">‚úï <span data-i18n="common.cancel">Cancel</span></button>
          <button type="button" class="modal-btn modal-btn-create" id="modal-create">+ <span data-i18n="common.create">Create</span></button>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="modals.settings.title">Settings</h3>
        </div>

        <div class="modal-field">
          <label data-i18n="modals.settings.language">Language</label>
          <div class="settings-language-row">
            <select id="settings-language" class="settings-select">
              <option value="en">English</option>
              <option value="zh">ÁÆÄ‰Ωì‰∏≠Êñá</option>
            </select>
          </div>
        </div>

        <div class="modal-field">
          <label data-i18n="modals.settings.audio">Audio</label>
          <div class="settings-slider-row">
            <span class="slider-label" data-i18n="modals.settings.volume">Volume</span>
            <input type="range" id="settings-volume" class="settings-slider" min="0" max="100" value="70" />
            <span id="settings-volume-value" class="slider-value">70%</span>
          </div>
          <div class="settings-checkbox-row">
            <label class="checkbox-label">
              <input type="checkbox" id="settings-spatial-audio" checked />
              <span data-i18n="modals.settings.spatial_audio">Spatial Audio</span>
            </label>
            <span class="field-hint-inline" data-i18n="modals.settings.spatial_hint">Volume/pan based on zone position</span>
          </div>
        </div>

        <div class="modal-field">
          <label data-i18n="modals.settings.privacy">Privacy</label>
          <div class="settings-checkbox-row">
            <label class="checkbox-label">
              <input type="checkbox" id="settings-streaming-mode" />
              <span data-i18n="modals.settings.streaming_mode">Streaming Mode</span>
            </label>
            <span class="field-hint-inline" data-i18n="modals.settings.streaming_hint">Hide username for privacy</span>
          </div>
        </div>

        <div class="modal-field">
          <label data-i18n="modals.settings.world">World</label>
          <div class="settings-slider-row">
            <span class="slider-label" data-i18n="modals.settings.grid_size">Grid Size</span>
            <input type="range" id="settings-grid-size" class="settings-slider" min="5" max="80" value="20" />
            <span id="settings-grid-size-value" class="slider-value">20</span>
          </div>
          <div class="field-hint" data-i18n="modals.settings.grid_hint">Number of hex rings from center. Larger = more space, may impact performance.</div>
        </div>

        <div class="modal-field">
          <label data-i18n="modals.settings.agent_connection">Agent Connection</label>
          <div class="settings-port-row">
            <span class="port-label">localhost:</span>
            <input type="number" id="settings-port" value="4003" min="1" max="65535" />
            <span id="settings-port-status" class="port-status"></span>
          </div>
          <div class="field-hint" data-i18n="modals.settings.agent_hint">Port where the Vibecraft agent is running. Changes require refresh.</div>
        </div>

        <div class="modal-field">
          <label data-i18n="modals.settings.sessions">Sessions</label>
          <div class="settings-actions">
            <button type="button" class="settings-action-btn" id="settings-refresh-sessions">üîÑ <span data-i18n="modals.settings.refresh_sessions">Refresh Sessions</span></button>
          </div>
        </div>

        <div class="modal-field">
          <label data-i18n="modals.settings.keyboard_shortcuts">Keyboard Shortcuts</label>
          <div id="keybind-settings" class="keybind-settings">
            <!-- Dynamically populated by KeybindSettings.ts -->
          </div>
          <div class="field-hint" data-i18n="modals.settings.shortcuts_hint">Click a keybind to change it. Press the new key combination, or Escape to cancel.</div>
        </div>

        <div class="modal-actions">
          <button type="button" class="modal-btn modal-btn-cancel" id="settings-close">‚úï <span data-i18n="common.close">Close</span></button>
        </div>
      </div>
    </div>

    <!-- About Modal -->
    <div id="about-modal">
      <div class="modal-content about-modal-content">
        <div class="modal-header">
          <h3 data-i18n="modals.about.title">Vibecraft</h3>
        </div>

        <div class="about-description">
          <p data-i18n="modals.about.description">Vibecraft is a A 3D visualization app for Claude Code.</p>
          <p data-i18n="modals.about.subtitle">Watch and manage your claudes in real-time - now featuring hexagonal grids!</p>
          <p class="about-subtitle" data-i18n="modals.about.sync_note">Vibecraft syncs with claude code instances running on your own machine. No files or
          code are sent to the web server.</p>
        </div>

        <div class="about-section">
          <div class="about-section-title" data-i18n="modals.about.commands">Commands</div>
          <div class="about-commands">
            <div class="about-cmd"><code>npx vibecraft</code><span data-i18n="modals.about.cmd_start">Start server</span></div>
            <div class="about-cmd"><code>npx vibecraft doctor</code><span data-i18n="modals.about.cmd_doctor">Diagnose issues</span></div>
            <div class="about-cmd"><code>npx vibecraft setup</code><span data-i18n="modals.about.cmd_setup">Reinstall hooks</span></div>
            <div class="about-cmd"><code>npx vibecraft uninstall</code><span data-i18n="modals.about.cmd_uninstall">Remove hooks</span></div>
          </div>
        </div>

        <div class="about-section">
          <div class="about-section-title" data-i18n="modals.about.troubleshooting">Troubleshooting</div>
          <p class="about-help-text" data-i18n="modals.about.troubleshooting_text">If a zone gets stuck, Claude Code may be waiting for input or in an unknown state. Attach to the tmux session to see what's happening:</p>
          <div class="about-commands">
            <div class="about-cmd"><code>tmux ls</code><span data-i18n="modals.about.cmd_tmux_ls">List sessions</span></div>
            <div class="about-cmd"><code>tmux attach -t <em>session</em></code><span data-i18n="modals.about.cmd_tmux_attach">Attach to session</span></div>
          </div>
        </div>

        <div class="about-section">
          <div class="about-section-title" data-i18n="modals.about.voice_input">Voice Input</div>
          <p class="about-help-text" data-i18n="modals.about.voice_hint">To enable voice input, add your Deepgram API key to <code>.env</code>:</p>
          <div class="about-commands">
            <div class="about-cmd"><code>DEEPGRAM_API_KEY=your_key_here</code></div>
          </div>
        </div>

        <div class="about-footer">
          <span id="about-version" class="about-version">v0.0.0</span>
          <span class="about-sep">¬∑</span>
          <span class="about-credit" data-i18n="modals.about.footer_credit">Elysian Labs</span>
        </div>

        <div class="modal-actions">
          <button type="button" class="modal-btn modal-btn-cancel" id="about-close" data-i18n="common.close">Close</button>
        </div>
      </div>
    </div>

    <!-- Question Modal (for AskUserQuestion) -->
    <div id="question-modal">
      <div class="modal-content question-modal-content">
        <div class="modal-header">
          <span class="question-badge" id="question-badge" data-i18n="modals.question.title">Question</span>
          <h3 id="question-header" data-i18n="modals.question.header">Claude needs input</h3>
        </div>

        <div class="question-text" id="question-text"></div>

        <div class="question-options" id="question-options">
          <!-- Options will be inserted here -->
        </div>

        <div class="question-other">
          <label for="question-other-input" data-i18n="modals.question.other_label">Or type your own response:</label>
          <textarea id="question-other-input" data-i18n="modals.question.other_placeholder" placeholder="Type here..." rows="2"></textarea>
        </div>

        <div class="modal-actions">
          <button type="button" class="modal-btn modal-btn-cancel" id="question-skip" data-i18n="modals.question.skip">Skip</button>
          <button type="button" class="modal-btn modal-btn-create" id="question-send-other" data-i18n="common.send">Send</button>
        </div>
      </div>
    </div>

    <!-- Permission Modal (for tool permissions) -->
    <div id="permission-modal">
      <div class="modal-content permission-modal-content">
        <div class="modal-header">
          <span class="permission-badge" data-i18n="modals.permission.title">Permission Required</span>
          <h3 id="permission-header">Allow Tool?</h3>
        </div>

        <div class="permission-context" id="permission-context">
          <!-- Context will be inserted here -->
        </div>

        <div class="permission-buttons" id="permission-buttons">
          <!-- Buttons will be generated dynamically based on options -->
        </div>
      </div>
    </div>

    <!-- Zone Info Modal (for session details) -->
    <div id="zone-info-modal">
      <div class="modal-content zone-info-modal-content">
        <div class="modal-header">
          <h3 data-i18n="modals.zone_info.title">Zone Info</h3>
          <button type="button" class="zone-info-close-btn" id="zone-info-close">&times;</button>
        </div>
        <div class="zone-info-body" id="zone-info-content">
          <!-- Content will be inserted dynamically -->
        </div>
      </div>
    </div>

    <!-- Text Label Modal (for hex text labels) -->
    <div id="text-label-modal">
      <div class="modal-content text-label-modal-content">
        <div class="modal-header">
          <h3 id="text-label-title" data-i18n="modals.text_label.title">Add Label</h3>
        </div>

        <div class="text-label-body">
          <textarea
            id="text-label-input"
            class="text-label-textarea"
            data-i18n="modals.text_label.placeholder"
            placeholder="Enter your text here..."
            maxlength="500"
            rows="4"
          ></textarea>
          <div class="text-label-footer">
            <span class="text-label-char-count" id="text-label-char-count">0/500</span>
            <span class="text-label-hint" data-i18n="modals.text_label.hint">Enter to save, Shift+Enter for newline</span>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="modal-btn modal-btn-cancel" id="text-label-cancel" data-i18n="common.cancel">Cancel</button>
          <button type="button" class="modal-btn modal-btn-create" id="text-label-save" data-i18n="common.save">Save</button>
        </div>
      </div>
    </div>

    <!-- Zone Timeout Modal (shown when zone creation takes too long) -->
    <div id="zone-timeout-modal">
      <div class="modal-content zone-timeout-content">
        <div class="modal-header">
          <h3 data-i18n="modals.timeout.title">Zone Not Responding</h3>
        </div>
        <p class="zone-timeout-text" data-i18n="modals.timeout.text">
          The zone is taking longer than expected to start. Claude Code may be stuck or waiting for input.
        </p>
        <div class="about-section">
          <div class="about-section-title" data-i18n="modals.about.troubleshooting">Troubleshooting</div>
          <div class="about-commands">
            <div class="about-cmd"><code>tmux ls</code><span data-i18n="modals.about.cmd_tmux_ls">List sessions</span></div>
            <div class="about-cmd"><code>tmux attach -t <em>session</em></code><span data-i18n="modals.about.cmd_tmux_attach">See what's happening</span></div>
          </div>
        </div>
        <p class="zone-timeout-hint" data-i18n="modals.timeout.hint">Also ensure your Claude Code is up to date.</p>
        <div class="modal-actions">
          <button type="button" class="modal-btn modal-btn-cancel" id="zone-timeout-close" data-i18n="common.close">Close</button>
        </div>
      </div>
    </div>

    <!-- Offline Banner (shown when user tries to interact while disconnected) -->
    <div id="offline-banner" class="offline-banner hidden">
      <span data-i18n="offline.banner">Not connected to local server</span>
      <button id="offline-banner-dismiss">√ó</button>
    </div>

    <!-- Not Connected Overlay -->
    <div id="not-connected-overlay">
      <div class="not-connected-content">
        <h2 data-i18n="offline.overlay_title">Vibecraft!</h2>
        <p class="not-connected-description" data-i18n="offline.overlay_desc">
          Vibecraft is a 3D app to watch and manage Claude Code instances.
        </p>
        <p class="not-connected-privacy" data-i18n="offline.overlay_privacy">
          Vibecraft syncs with CC instances running on your local machine. Vibecraft is an interface - no files or code
          are sent to this server.
        </p>
        <div class="not-connected-setup">
          <p class="not-connected-setup-label" data-i18n="offline.get_started">Get started:</p>
          <div class="not-connected-code">npx vibecraft setup && npx vibecraft</div>
        </div>
        <div class="not-connected-actions">
          <button class="not-connected-btn not-connected-btn-retry" id="retry-connection">‚Üª <span data-i18n="common.retry">Reconnect</span></button>
          <button class="not-connected-btn not-connected-btn-explore" id="explore-offline">üëÄ <span data-i18n="offline.explore">Explore</span></button>
        </div>
      </div>
    </div>

    <!-- Toast notifications -->
    <div id="toast-container"></div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
